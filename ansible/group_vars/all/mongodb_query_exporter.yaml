mongodb_query_exporter_aggregation_list:
  - |-
      - database: scapp
        collection: schools
        metrics:
        - name: sc_schools_total
          type: gauge
          help: 'The number of schools'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {"$count":"total"}
          ]
  - |-
      - database: scapp
        collection: accounts
        metrics:
        - name: sc_accounts_total
          type: gauge
          help: 'The number of accounts'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {"$count":"total"}
          ]
# Admin Accounts
  - |-
      - database: scapp
        collection: accounts
        metrics:
        - name: sc_accounts_admin_total
          type: gauge
          help: 'The number of admin accounts'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {
                "$lookup" : {
                    "from" : "users",
                    "localField" : "userId",
                    "foreignField" : "_id",
                    "as" : "->users"
                }
            },
            {
                "$match": { "->users.roles": { "$in": ["ObjectId","0000d186816abba584714c96"] } }
            },
            { "$count": "total" }
          ]
# Teacher Accounts
  - |-
      - database: scapp
        collection: accounts
        metrics:
        - name: sc_accounts_teachers_total
          type: gauge
          help: 'The number of teacher accounts'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {
                "$lookup" : {
                    "from" : "users",
                    "localField" : "userId",
                    "foreignField" : "_id",
                    "as" : "->users"
                }
            },
            {
                "$match": { "->users.roles": { "$in": ["ObjectId","0000d186816abba584714c98"] } }
            },
            { "$count": "total" }
          ]
# Pupil Accounts
  - |-
      - database: scapp
        collection: accounts
        metrics:
        - name: sc_accounts_pupils_total
          type: gauge
          help: 'The number of pupil accounts'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {
                "$lookup" : {
                    "from" : "users",
                    "localField" : "userId",
                    "foreignField" : "_id",
                    "as" : "->users"
                }
            },
            {
                "$match": { "->users.roles": { "$in": ["ObjectId","0000d186816abba584714c99"] } }
            },
            { "$count": "total" }
          ]
#TODO: Split up basic count metrics
  - |-
      - database: scapp
        collection: classes
        metrics:
        - name: sc_classes_total
          type: gauge
          help: 'The number of classes'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {"$count":"total"}
          ]
      - database: scapp
        collection: courses
        metrics:
        - name: sc_courses_total
          type: gauge
          help: 'The number of courses'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {"$count":"total"}
          ]
      - database: scapp
        collection: coursegroups
        metrics:
        - name: sc_coursegroups_total
          type: gauge
          help: 'The number of coursegroups'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {"$count":"total"}
          ]
      - database: scapp
        collection: lessons
        metrics:
        - name: sc_lessons_total
          type: gauge
          help: 'The number of lessons'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {"$count":"total"}
          ]