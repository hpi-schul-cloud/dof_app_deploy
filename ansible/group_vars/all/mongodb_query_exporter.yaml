mongodb_query_exporter_aggregations: |-
      - database: scapp
        collection: schools
        metrics:
        - name: sc_schools
          type: gauge
          help: 'The number of schools'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {"$count":"total"}
          ]

      - database: scapp
        collection: accounts
        metrics:
        - name: sc_accounts
          type: gauge
          help: 'The number of accounts'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {"$count":"total"}
          ]

      - database: scapp
        collection: users
        metrics:
        - name: sc_users
          type: gauge
          help: 'The number of users'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {"$count":"total"}
          ]
      - database: scapp
        collection: users
        metrics:
        - name: sc_admin_users
          type: gauge
          help: 'The number of admin users'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {
                "$lookup": {
                  "from": "roles",
                  "localField": "roles",
                  "foreignField": "_id",
                  "as": "userRole"
                }
            },
            {
                "$unwind": {
                  "path": "$userRole"
                }
            },
            {
                "$match": {
                  "userRole.name": "administrator"
                }
            },
            { 
                "$count": "total" 
            }
          ]
      - database: scapp
        collection: users
        metrics:
        - name: sc_teacher_users
          type: gauge
          help: 'The number of teacher users'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {
                "$lookup": {
                  "from": "roles",
                  "localField": "roles",
                  "foreignField": "_id",
                  "as": "userRole"
                }
            },
            {
                "$unwind": {
                  "path": "$userRole"
                }
            },
            {
                "$match": {
                  "userRole.name": "teacher"
                }
            },
            { 
                "$count": "total" 
            }
          ]
      - database: scapp
        collection: users
        metrics:
        - name: sc_student_users
          type: gauge
          help: 'The number of student users'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {
                "$lookup": {
                  "from": "roles",
                  "localField": "roles",
                  "foreignField": "_id",
                  "as": "userRole"
                }
            },
            {
                "$unwind": {
                  "path": "$userRole"
                }
            },
            {
                "$match": {
                  "userRole.name": "student"
                }
            },
            { 
                "$count": "total" 
            }
          ]

      - database: scapp
        collection: classes
        metrics:
        - name: sc_classes
          type: gauge
          help: 'The number of classes'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {"$count":"total"}
          ]
      - database: scapp
        collection: courses
        metrics:
        - name: sc_courses
          type: gauge
          help: 'The number of courses'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {"$count":"total"}
          ]
      - database: scapp
        collection: coursegroups
        metrics:
        - name: sc_coursegroups
          type: gauge
          help: 'The number of coursegroups'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {"$count":"total"}
          ]

      - database: scapp
        collection: lessons
        metrics:
        - name: sc_lessons
          type: gauge
          help: 'The number of lessons'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {"$count":"total"}
          ]
      - database: scapp
        collection: lessons
        metrics:
        - name: sc_text_lessons
          type: gauge
          help: 'The number of text lessons'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            { "$match" : { "contents.component" : "text" }}, 
            { "$project" : { "contents" : 1 }}, 
            { "$unwind" : { "path" : "$contents" }}, 
            { "$match" : { "contents.component" : "text" }}, 
            { "$count" : "total" }
          ]
      - database: scapp
        collection: lessons
        metrics:
        - name: sc_task_lessons
          type: gauge
          help: 'The number of task lessons'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
              { "$match" : { "contents.component" : "internal" }}, 
              { "$project" : { "contents" : 1 }}, 
              { "$unwind" : { "path" : "$contents" }}, 
              { "$match" : { "contents.component" : "internal" }}, 
              { "$count" : "total" }
          ]
      - database: scapp
        collection: lessons
        metrics:
        - name: sc_learning_store_lessons
          type: gauge
          help: 'The number of resource lessons (Lern-Store)'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
              { "$match" : { "contents.component" : "resources" }}, 
              { "$project" : { "contents" : 1 }}, 
              { "$unwind" : { "path" : "$contents" }}, 
              { "$match" : { "contents.component" : "resources" }}, 
              { "$count" : "total" }
          ]
      - database: scapp
        collection: lessons
        metrics:
        - name: sc_nexboard_lessons
          type: gauge
          help: 'The number of nexboard lessons'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            { "$match" : { "contents.component" : "neXboard" }}, 
            { "$project" : { "contents" : 1 }}, 
            { "$unwind" : { "path" : "$contents" }}, 
            { "$match" : { "contents.component" : "neXboard" }}, 
            { "$count" : "total" }
          ]
      - database: scapp
        collection: lessons
        metrics:
        - name: sc_etherpad_lessons
          type: gauge
          help: 'The number of etherpad lessons'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            { "$match" : { "contents.component" : "Etherpad" }}, 
            { "$project" : { "contents" : 1 }}, 
            { "$unwind" : { "path" : "$contents" }}, 
            { "$match" : { "contents.component" : "Etherpad" }}, 
            { "$count" : "total" }
          ]
      - database: scapp
        collection: lessons
        metrics:
        - name: sc_geogebra_lessons
          type: gauge
          help: 'The number of geoGebra lessons'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            { "$match" : { "contents.component" : "geoGebra" }}, 
            { "$project" : { "contents" : 1 }}, 
            { "$unwind" : { "path" : "$contents" }}, 
            { "$match" : { "contents.component" : "geoGebra" }}, 
            { "$count" : "total" }
          ]

      - database: scapp
        collection: homeworks
        metrics:
        - name: sc_homeworks
          type: gauge
          help: 'The number of homeworks'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {"$count":"total"}
          ]
      - database: scapp
        collection: homeworks
        metrics:
        - name: sc_private_homeworks
          type: gauge
          help: 'The number of private homeworks'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            { "$match" : { "private" : true }},
            { "$count" : "total" }
          ]
      - database: scapp
        collection: homeworks
        metrics:
        - name: sc_teamsubmission_homeworks
          type: gauge
          help: 'The number of homeworks submitted by a team'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            { "$match" : { "teamSubmissions" : true }},
            { "$count" : "total" }
          ]
      - database: scapp
        collection: homeworks
        metrics:
        - name: sc_course_homeworks
          type: gauge
          help: 'The number of homeworks as part of a course'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            { "$match" : { "lessonId" : { "$not" : { "$type" : 7 } }, "courseId" : { "$type" : 7 } }},
            { "$count" : "total" }
          ]
      - database: scapp
        collection: homeworks
        metrics:
        - name: sc_coursegroup_homeworks
          type: gauge
          help: 'The number of homeworks as part of a coursegroup'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            { "$match" : { "lessonId" : { "$type" : 7 }, "courseId" : { "$type" : 7 } }},
            { "$count" : "total" }
          ]
      - database: scapp
        collection: filerecords
        metrics:
        - name: sc_task_attached_files
          type: gauge
          help: 'The number of files that are attached to a task'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            { "$match" : { "parentType" : "tasks" }}, 
            { "$project" : { "_id" : 1, "parent" : 1 }}, 
            { "$group" : { "_id" : "$parent" }}, 
            { "$count" : "total" }
          ]

      - database: scapp
        collection: submissions
        metrics:
        - name: sc_submissions
          type: gauge
          help: 'The number of submissions'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {"$count":"total"}
          ]

      - database: scapp
        collection: teams
        metrics:
        - name: sc_teams
          type: gauge
          help: 'The number of teams'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {"$count":"total"}
          ]

      - database: scapp
        collection: videoconferences
        metrics:
        - name: sc_videoconferences
          type: gauge
          help: 'The number of videoconferences'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            {"$count":"total"}
          ]

      - database: scapp
        collection: files
        metrics:
        - name: sc_old_filestorage_files
          type: gauge
          help: 'The number of files in the old file storage'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            { "$count" : "total" }
          ]
      - database: scapp
        collection: files
        metrics:
        - name: sc_old_filestorage_user_files
          type: gauge
          help: 'The number of files in the old file storage that belong to a user'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            { "$match" : {"refOwnerModel": "user"} },
            { "$count" : "total" }
          ]
      - database: scapp
        collection: files
        metrics:
        - name: sc_old_filestorage_course_files
          type: gauge
          help: 'The number of files in the old file storage that belong to a course'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            { "$match" : {"refOwnerModel": "course"} },
            { "$count" : "total" }
          ]
      - database: scapp
        collection: files
        metrics:
        - name: sc_old_filestorage_team_files
          type: gauge
          help: 'The number of files in the old file storage that belong to a team'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            { "$match" : {"refOwnerModel": "teams"} },
            { "$count" : "total" }
          ]

      - database: scapp
        collection: filerecords
        metrics:
        - name: sc_new_filestorage_files
          type: gauge
          help: 'The number of files in the new file storage'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            { "$count" : "total" }
          ]

      - database: scapp
        collection: news
        metrics:
        - name: sc_news
          type: gauge
          help: 'The number of news entries'
          value: total
          overrideEmpty: true
          emptyValue: 0
          labels: []
          constLabels: []
        mode: pull
        pipeline: |
          [
            { "$count" : "total" }
          ]