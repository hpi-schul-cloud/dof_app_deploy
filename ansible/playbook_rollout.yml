---
- name: App Deploy
  hosts:
    - reference
    - production
    - loadtest
    - infra
  connection: local
  roles:
    - role: sys
    - role: pre_deployment
    - role: dof_mongo
    - role: dof_postgresql
    - role: dof_rabbitmq
    - role: dof_redis
    - role: dof_mailcatcher
      when: WITH_MAILCATCHER is defined and WITH_MAILCATCHER|bool
    - role: libreoffice
    - role: maildrop
    - role: storage
      when: WITH_STORAGE is defined and WITH_STORAGE|bool
    - role: keda
      when: KEDA_ENABLED is defined and KEDA_ENABLED|bool
    - role: hydra
    - role: erwin-idm
    - role: dof_etherpad_nginx
    - role: dof_etherpad
    - role: clamav
    - role: schulcloud-server-core
    - role: schulcloud-server-ldapsync
      when: WITH_LDAP is defined and WITH_LDAP|bool
    - role: schulcloud-server-tspsync
    - role: schulcloud-server-h5p
    - role: schulcloud-server-migration-system
    - role: schulcloud-server-init
    - role: schulcloud-client-core
    - role: nuxt-client-core
    - role: h5p-library-management
      when: WITH_H5P_LIBRARY_MANAGEMENT is defined and WITH_H5P_LIBRARY_MANAGEMENT|bool
    - role: h5p-proxy
    - role: h5p-staticfiles-server-core
    - role: superhero-dashboard
    - role: schulcloud-calendar-core
    - role: schulcloud-calendar-init
    - role: antivirus_check_service
    - role: version-aggregator
    - role: rocketchat
    - role: mongodb_query_exporter
    - role: tldraw-client-core
    - role: tldraw-server
    - role: tldraw-valkey
    - role: ingress
    - role: post_deployment
    - role: moin-schule-sync
      when: WITH_MOIN_SCHULE is defined and WITH_MOIN_SCHULE|bool
