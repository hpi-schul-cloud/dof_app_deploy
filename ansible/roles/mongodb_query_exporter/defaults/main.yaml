mongodb_query_exporter_chart_version: 3.0.1
mongodb_query_exporter_image_version: 2.0.2
mongodb_query_exporter_mongodb_uri: mongodb://mongo-svc:27017/?directConnection=true
mongodb_query_exporter_secret_name: "mongodb-query-exporter-secret"
mongodb_query_exporter_values:
  image:
    tag: "{{ mongodb_query_exporter_image_version }}"

  mongodb:
  - "{{ mongodb_query_exporter_mongodb_uri }}"

  existingSecret:
    name: "mongodb-query-exporter-secret"

  service:
    enabled: true

  serviceMonitor:
    enabled: true
    interval: 60s

  config: |
    version: 3.0
    bind: 0.0.0.0:9412
    metricsPath: /metrics
    logLevel: debug
    global:
      queryTimeout: "10s"
      maxConnection: 3
      defaultCache: 0
    aggregations:
    {{ mongodb_query_exporter_aggregations }}

mongodb_query_exporter_aggregations: |
  - database: scapp
    collection: accounts
    metrics:
    - name: sc_accounts_total
      type: gauge
      help: 'The number of accounts'
      value: total
      overrideEmpty: true
      emptyValue: 0
      labels: []
      constLabels: []
    mode: pull
    pipeline: |
      [
        {"$count":"total"}
      ]
  - database: scapp
    collection: schools
    metrics:
    - name: sc_schools_total
      type: gauge
      help: 'The number of schools'
      value: total
      overrideEmpty: true
      emptyValue: 0
      labels: []
      constLabels: []
    mode: pull
    pipeline: |
      [
        {"$count":"total"}
      ]
  - database: scapp
    collection: classes
    metrics:
    - name: sc_classes_total
      type: gauge
      help: 'The number of classes'
      value: total
      overrideEmpty: true
      emptyValue: 0
      labels: []
      constLabels: []
    mode: pull
    pipeline: |
      [
        {"$count":"total"}
      ]
  - database: scapp
    collection: courses
    metrics:
    - name: sc_courses_total
      type: gauge
      help: 'The number of courses'
      value: total
      overrideEmpty: true
      emptyValue: 0
      labels: []
      constLabels: []
    mode: pull
    pipeline: |
      [
        {"$count":"total"}
      ]
  - database: scapp
    collection: coursegroups
    metrics:
    - name: sc_coursegroups_total
      type: gauge
      help: 'The number of coursegroups'
      value: total
      overrideEmpty: true
      emptyValue: 0
      labels: []
      constLabels: []
    mode: pull
    pipeline: |
      [
        {"$count":"total"}
      ]
  - database: scapp
    collection: lessons
    metrics:
    - name: sc_lessons_total
      type: gauge
      help: 'The number of lessons'
      value: total
      overrideEmpty: true
      emptyValue: 0
      labels: []
      constLabels: []
    mode: pull
    pipeline: |
      [
        {"$count":"total"}
      ]