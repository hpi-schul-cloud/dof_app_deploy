  - name: add Service
    kubernetes.core.k8s:
      kubeconfig: ~/.kube/config 
      namespace: "{{ NAMESPACE }}"
      template: svc.yml.j2
    when: WITH_REDIS

  - name: remove Service
    kubernetes.core.k8s:
      kubeconfig: ~/.kube/config 
      namespace: "{{ NAMESPACE }}"
      state: absent
      api_version: v1
      kind: Service
      name: redis-svc
    when: not WITH_REDIS
      
  - name: add Persistent Volumes Claim  
    kubernetes.core.k8s:
      kubeconfig: ~/.kube/config 
      namespace: "{{ NAMESPACE }}"
      template: pvc.yml.j2
    when: WITH_REDIS
      
  - name: add Deployment
    kubernetes.core.k8s:
      kubeconfig: ~/.kube/config 
      namespace: "{{ NAMESPACE }}"
      template: deployment.yml.j2
    when: WITH_REDIS
      
  - name: remove Deployment
    kubernetes.core.k8s:
      kubeconfig: ~/.kube/config 
      namespace: "{{ NAMESPACE }}"
      template: deployment.yml.j2
      state: absent
      api_version: apps/v1
      kind: Deployment
      name: redis-deployment
    when: not WITH_REDIS
      
  - name: remove Persistent Volumes Claim  
    kubernetes.core.k8s:
      kubeconfig: ~/.kube/config 
      namespace: "{{ NAMESPACE }}"
      template: pvc.yml.j2
      state: absent
      api_version: v1
      kind: PersistentVolumeClaim
      name: redis-pvc
    when: not WITH_REDIS
      