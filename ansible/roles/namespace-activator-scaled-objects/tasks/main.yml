---

  - name: trigger auth
    kubernetes.core.k8s:
      kubeconfig: ~/.kube/config
      namespace: "{{ NAMESPACE }}"
      template: sc-common-mongodb-trigger-auth.yml.j2
    tags:
      - keda

  - name: apply scaled objects
    kubernetes.core.k8s:
      kubeconfig: ~/.kube/config
      namespace: "{{ NAMESPACE }}"
      template: scaled-object.yml.j2
      apply: true
      state: "{{ 'present' if item.with | default(true) else 'absent'}}"
    loop: "{{ deployments_for_scaled_objects }}"
    loop_control:
      label: "{{ item.name }}"
    tags:
      - keda

  - name: client nginx redirect configmap
    kubernetes.core.k8s:
      kubeconfig: ~/.kube/config
      namespace: "{{ NAMESPACE }}"
      template: client-nginx-redirect-configmap.yml.j2
    tags:
      - keda

  - name: namespace activator redirection deployment
    kubernetes.core.k8s:
      kubeconfig: ~/.kube/config
      namespace: "{{ NAMESPACE }}"
      template: namespace-activator-redirection-deployment.yml.j2
    tags:
      - keda

  - name: namespace activator redirection scaledobject
    kubernetes.core.k8s:
      kubeconfig: ~/.kube/config
      namespace: "{{ NAMESPACE }}"
      template: namespace-activator-redirection-scaledobject.yml.j2
    tags:
      - keda
