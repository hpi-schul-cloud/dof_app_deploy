---
name: deploy dev 

on:
  workflow_call:
    inputs:
      namespace:
         required: true
         type: string  
    secrets:
      KUBECONFIG:
        required: true

permissions:
  contents: read

jobs:
  delete_namespaces_dbc:
    runs-on: ubuntu-latest
    if: needs.examine_branch_existence.outputs.are_all_branches_deleted  == 'true'
    needs:
      - examine_branch_existence
      - create_branch_identifier
    steps:
      - run: |
          mkdir files
          echo "${{ secrets.KUBECONFIG }}" > files/config
      - name: delete custom resources and namespaces 
        run: |
          kubectl --kubeconfig=files/config --namespace ${{ inputs.namespace }} delete --ignore-not-found=true --all=true ScaledObject
          kubectl --kubeconfig=files/config --namespace ${{ inputs.namespace }} delete --ignore-not-found=true --all=true TriggerAuthentication
          kubectl --kubeconfig=files/config --namespace ${{ inputs.namespace }} delete --ignore-not-found=true --all=true OnePasswordItem
          kubectl --kubeconfig=files/config delete --ignore-not-found=true ns ${{ inputs.namespace }}
      - name: remove kubeconfig
        run: |
          rm -rf  /config
